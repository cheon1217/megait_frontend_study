<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>학과관리 ::: MySchool</title>
        <link rel="stylesheet" href="assets/css/style.css" />
    </head>
    <body>
        <div class="container">
            <div data-include="inc/header.html"></div>
            <section>
                <dl>
                    <dt>학과번호</dt>
                    <dd class="id"></dd>
                    <dt>학과명</dt>
                    <dd class="dname"></dd>
                    <dt>학과위치</dt>
                    <dd class="loc"></dd>
                </dl>
                <a href="index.html">목록보기</a> | <a href="#" class="btn-edit">수정하기</a> |
                <a href="#" class="btn-delete">삭제하기</a>
            </section>
            <div data-include="inc/footer.html"></div>

            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script src="assets/js/include.js"></script>
            <script src="assets/js/UtilHelper.js"></script>
            <script>
                (async () => {
                    const params = utilHelper.getQuery();

                    if (!params.id) {
                        alert("학과번호가 없습니다.");
                        history.back();
                        return;
                    }

                    let response = null;

                    try {
                        response = await axios.get(`http://localhost:3001/department/${params.id}/`);
                        console.log(response.data);
                    } catch (e) {
                        console.error(e);
                        alert("요청을 처리하는데 실패했습니다.");
                        return;
                    }

                    document.querySelector(".id").innerHTML = response.data.id;
                    document.querySelector(".dname").innerHTML = response.data.dname;
                    document.querySelector(".loc").innerHTML = response.data.loc;

                    document.querySelector(".btn-edit").setAttribute("href", `edit.html?id=${response.data.id}`);

                    const btnDelete = document.querySelector(".btn-delete");
                    btnDelete.dataset.id = response.data.id;
                    btnDelete.dataset.dname = response.data.dname;
                })();

                document.querySelector(".btn-delete").addEventListener("click", async e => {
                    e.preventDefault();

                    const current = e.currentTarget;
                    const id = current.dataset.id;
                    const dname = current.dataset.dname;

                    if (confirm(`정말 ${dname}(을)를 삭제하시겠습니까?`)) {
                        try {
                            await axios.delete(`http://localhost:3001/department/${id}`);
                        } catch (e) {
                            console.error(e);
                            alert("요청을 처리하는데 실패했습니다.");
                            return;
                        }
                        window.location = "index.html";
                    }
                });
            </script>
        </div>
    </body>
</html>