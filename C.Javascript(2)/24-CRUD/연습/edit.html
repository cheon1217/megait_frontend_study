<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>학과관리 ::: MySchool</title>
        <link rel="stylesheet" href="assets/css/style.css" />
    </head>
    <body>
        <div class="container">
            <div data-include="inc.header.html"></div>
            <section>
                <form name="form" id="department-form">
                    <input type="hidden" name="id" id="id" />
                    <form name="form" id="department-form">
                        <div class="form-group">
                            <label for="dname">학과이름 <span class="text-danger">*</span></label>
                            <div>
                                <input type="text" name="dname" id="dname" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="loc">학과위치</label>
                            <div>
                                <input type="text" name="loc" id="loc" />
                            </div>
                        </div>
                        <hr />
                        <div class="text-center">
                            <button type="submit">수정하기</button>
                            <button type="reset">다시작성</button>
                        </div>
                </form>
            </section>
            <div data-include="inc/footer.html"></div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="assets/js/include.js"></script>
        <script src="assets/js/UtilHelper.js"></script>
        <script type="text/javascript">
            (async () => {
                const params = utilHelper.getQuery();

                if (!params.id) {
                    alert("학과번호가 없습니다.");
                    history.back();
                    return;
                }

                let response = null;

                try {
                    response = await axios.get(`http://localhost:3001/department/${params.id}/`);
                    console.log(response.data);
                } catch (e) {
                    cconsole.error(e);
                    alert("요청을 처리하는데 실패했습니다.");
                    return;
                }

                document.querySelector("#id").value = response.data.id;
                document.querySelector("#dname").value = response.data.dname;
                document.querySelector("#loc").value = response.data.loc;
            })();

            document.querySelector("#department-form").addEventListener("submit", async e => {
                e.preventDefault();

                const id = document.querySelector("#id").value;
                const dname = document.querySelector("#dname").value;
                const loc = document.querySelector("#loc").value;

                try {
                    await axios.put(`http://localhost:3001/department/${id}/`, {
                        dname: dname,
                        loc: loc,
                    });
                } catch (e) {
                    console.error(e);
                    alert("요청을 처리하는데 실패했습니다.");
                    return;
                }

                window.location = `view.html?id=${id}`;
            });
        </script>
    </body>
</html>