<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <style>
            #loading {
                width: 100px;
                height: 100px;
                background: url(../img/loading.gif) no-repeat center/cover;
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                z-index: 99999999999;
                display: none;
            }

            #loading.active {
                display: block;
            }
        </style>
    </head>

    <body>
        <div id="loading"></div>
        <h1>우편번호검색</h1>

        <input type="text" id="keyword" />

        <button type="button" id="btn">데이터 가져오기</button>

        <hr />

        <table border="1">
            <thead>
                <tr>
                    <th>우편번호</th>
                    <th>도로명주소</th>
                    <th>지번주소</th>
                </tr>
            </thead>
            <tbody id="list-body"></tbody>
        </table>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            /** 날짜값이 변경된 경우에 대한 이벤트 */
            document.querySelector("#btn").addEventListener("click", async e => {
                /** 1) 기본 준비 */
                // 로딩바 표시하기
                const loading = document.querySelector("#loading");
                loading.classList.add("active");

                const userInput = document.querySelector("#keyword").value.trim();

                if (!userInput) {
                    alert("검색어를 입력해주세요.");
                    document.querySelector("#keyword").focus();
                    return;
                }

                // 검색결과를 저장할 빈 변수
                let response = null;

                const url = "http://business.juso.go.kr/addrlink/addrLinkApi.do";

                /** 2) Ajax 요청 */
                try {
                    response = await axios.get(url, {
                        params: {
                            confmKey: "devU01TX0FVVEgyMDIzMTEwODIxMTQwNDExNDI1NjY=",
                            currentPage: 1,
                            countPerPage: 50,
                            keyword: userInput,
                            resultType: "json",
                        },
                    });

                    console.log(response.data);
                } catch (error) {
                    console.error(`[Error Code] ${error.code}`);
                    console.error(`[Error Message] ${error.message}`);
                    let alertMsg = error.message;

                    if (error.response !== undefined) {
                        const errorMsg = `${error.response.status} error - ${error.response.statusText}`;
                        console.error(`[HTTP Status] ${errorMsg}`);
                        alertMsg += `\n${errorMsg}`;
                    }

                    alert(alertMsg);

                    return;
                } finally {
                    loading.classList.remove("active");
                }

                /** 3) OpenAPI의 응답 결과를 화면에 표시하기 */
                // 목록이 표시될 <tbody>영역
                const listBody = document.querySelector("#list-body");

                // 이미 출력되고 있는 항목이 있다면 삭제한다.
                Array.from(listBody.getElementsByTagName("tr")).map((v, i) => {
                    listBody.removeChild(v);
                });

                response.data.results.juso.forEach((v, i) => {
                    const tr = document.createElement("tr");
                    listBody.appendChild(tr);

                    const td1 = document.createElement("td");
                    td1.innerHTML = v.zipNo;
                    tr.appendChild(td1);

                    const td2 = document.createElement("td");
                    td2.innerHTML = v.roadAddr;
                    tr.appendChild(td2);

                    const td3 = document.createElement("td");
                    td3.innerHTML = v.jibunAddr;
                    tr.appendChild(td3);

                    listBody.appendChild(tr);
                });
            });
        </script>
    </body>
</html>